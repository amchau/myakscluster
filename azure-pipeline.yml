pool:
  vmImage: 'Ubuntu 16.04'

trigger: none 

pr: none 

variables:
  location: eastus
  nodeCount: 1
  nodeSize: Standard_B2s
  # define 6 more variables: subscriptionId, spId, spPassword, spTenantId, aks and rg in the pipeline UI definition

steps:
- bash: |
    az login --service-principal -u $(spId) -p $(spPassword) --tenant $(spTenantId)
    az account set -s $(subscriptionId)
    suffix=$(shuf -i 1000-9999 -n 1)
    az group create -n $(rg)-$(suffix) -l $(location)
    k8sVersion=$(az aks get-versions -l $(location) --query 'orchestrators[-1].orchestratorVersion' -o tsv)
    az aks create -l $(location) -n $(aks)-$(suffix) -g $(rg)-$(suffix) --generate-ssh-keys -k $(k8sVersion) -s $(nodeSize) -c $(nodeCount)
  displayName: 'create rg and aks'
